---
name: &name autoneg-controller-manager

createNamespace: true

annotations: {}
  # annontated: true

labels:
  app: autoneg
  control-plane: controller-manager

securityContext:
  runAsNonRoot: true

# -- Autoscaling ranges, set minReplicas and maxReplicas if required
autoscaling: {}
#  minReplicas: 1
#  maxReplicas: 10

replicas: 2
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - autoneg
              - key: control-plane
                operator: In
                values:
                  - controller-manager
          topologyKey: kubernetes.io/hostname

# Pod Disruption Budget configuration
podDisruptionBudget:
  # Enable or disable PDB creation
  enabled: true
  # Specify either minAvailable or maxUnavailable, not both
  minAvailable: 1
  # maxUnavailable: 1

# Pod Monitoring configuration for managed collection
podMonitoring:
  enabled: true
  port: 8443

serviceAccount:
  create: true
  name: autoneg-controller-manager
  annotations: {}
  automountServiceAccountToken: true

volumes: []
#  - name: service-account-token
#    projected:
#      defaultMode: 420
#      sources:
#        - serviceAccountToken:
#            expirationSeconds: 3600
#            path: token
#        - configMap:
#            items:
#            - key: ca.crt
#              path: ca.crt
#            name: kube-root-ca.crt
#        - downwardAPI:
#            items:
#            - fieldRef:
#                apiVersion: v1
#                fieldPath: metadata.namespace
#              path: namespace

nodeSelector:
  iam.gke.io/gke-metadata-server-enabled: "true"

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1

service:
  port: 8443

# containers
gke_autoneg_controller:
  name: manager
  image:
    # gke_autoneg_controller.image.digest -- Controller image digest to use, takes precedence over tag if specified
    digest: ""
    # gke_autoneg_controller.image.repository -- Controller image repository to use
    repository: ghcr.io/googlecloudplatform/gke-autoneg-controller/gke-autoneg-controller
    # gke_autoneg_controller.image.tag -- Controller image tag to use, defaults to v{{.Chart.AppVersion}}
    tag: ""
  command:
    - /manager
  args:
    - --health-probe-bind-address=:8081
    - --metrics-bind-address=:8443
    - --zap-encoder=json
  securityContext:
    allowPrivilegeEscalation: false
    privileged: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
    runAsUser: 65532
    runAsGroup: 65532
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  livenessProbe:
    httpGet:
      path: /healthz
      port: 8081
    initialDelaySeconds: 15
    periodSeconds: 20
  readinessProbe:
    httpGet:
      path: /readyz
      port: 8081
    initialDelaySeconds: 5
    periodSeconds: 10
  resources:
    limits:
      cpu: 100m
      memory: 30Mi
    requests:
      cpu: 100m
      memory: 20Mi
  #volumeMounts:
  #  - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
  #    name: service-account-token
  #    readOnly: true
